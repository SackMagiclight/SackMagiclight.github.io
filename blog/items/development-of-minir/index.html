<!doctype html>
<html data-n-head-ssr lang="ja" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22ja%22%7D%7D">
  <head>
    <title>MinIRはどのように作られたか</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><meta data-n-head="ssr" data-hid="og:site_name" property="og:site_name" content="GAFTALK"><meta data-n-head="ssr" data-hid="og:type" property="og:type" content="website"><meta data-n-head="ssr" data-hid="description" property="description" content="いろいろなこと"><meta data-n-head="ssr" data-hid="og:description" property="og:description" content="いろいろなこと"><meta data-n-head="ssr" data-hid="og:title" property="og:title" content="MinIRはどのように作られたか"><meta data-n-head="ssr" data-hid="og:url" property="og:url" content="https://www.gaftalk.com/blog/items/development-of-minir"><meta data-n-head="ssr" data-hid="og:image" property="og:image" content="https://www.gaftalk.com/blog/img/aws.png"><meta data-n-head="ssr" data-hid="twitter:card" property="twitter:card" content="summary"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link data-n-head="ssr" rel="manifest" href="/site.webmanifest"><link rel="preload" href="/_nuxt/9a8cbb4.js" as="script"><link rel="preload" href="/_nuxt/d600e52.js" as="script"><link rel="preload" href="/_nuxt/a5b918d.js" as="script"><link rel="preload" href="/_nuxt/eef1235.js" as="script"><link rel="preload" href="/_nuxt/0b107f7.js" as="script"><style data-vue-ssr-id="65b97e00:0 15f0552d:0 b682ae5a:0">/*! tailwindcss v2.2.16 | MIT License | https://tailwindcss.com*//*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */*,::after,::before{box-sizing:border-box}html{-moz-tab-size:4;-o-tab-size:4;tab-size:4}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}body{font-family:system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji'}hr{height:0;color:inherit}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,'Liberation Mono',Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],button{-webkit-appearance:button}legend{padding:0}progress{vertical-align:baseline}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}fieldset{margin:0;padding:0}ol,ul{list-style:none;margin:0;padding:0}html{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}body{font-family:inherit;line-height:inherit}*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:currentColor}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input:-ms-input-placeholder,textarea:-ms-input-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}*,::after,::before{--tw-border-opacity:1;border-color:rgba(229,231,235,var(--tw-border-opacity))}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}.prose{color:#374151;max-width:65ch}.prose a{color:#111827;text-decoration:underline;font-weight:500}.prose strong{color:#111827;font-weight:600}.prose ol[type="a"]{--list-counter-style:lower-alpha}.prose ol[type="a"s]{--list-counter-style:lower-alpha}.prose ol[type="i"]{--list-counter-style:lower-roman}.prose ol[type="i"s]{--list-counter-style:lower-roman}.prose ol[type="1"]{--list-counter-style:decimal}.prose ol>li{position:relative;padding-left:1.75em}.prose ol>li::before{content:counter(list-item,var(--list-counter-style,decimal)) ".";position:absolute;font-weight:400;color:#6b7280;left:0}.prose ul>li{position:relative;padding-left:1.75em}.prose ul>li::before{content:"";position:absolute;background-color:#d1d5db;border-radius:50%;width:.375em;height:.375em;top:calc(.875em - .1875em);left:.25em}.prose hr{border-color:#e5e7eb;border-top-width:1px;margin-top:3em;margin-bottom:3em}.prose blockquote{font-weight:500;font-style:italic;color:#111827;border-left-width:.25rem;border-left-color:#e5e7eb;quotes:"\201C""\201D""\2018""\2019";margin-top:1.6em;margin-bottom:1.6em;padding-left:1em}.prose blockquote p:first-of-type::before{content:open-quote}.prose blockquote p:last-of-type::after{content:close-quote}.prose h1{color:#111827;font-weight:800;font-size:2.25em;margin-top:0;margin-bottom:.8888889em;line-height:1.1111111}.prose h2{color:#111827;font-weight:700;font-size:1.5em;margin-top:2em;margin-bottom:1em;line-height:1.3333333}.prose h3{color:#111827;font-weight:600;font-size:1.25em;margin-top:1.6em;margin-bottom:.6em;line-height:1.6}.prose h4{color:#111827;font-weight:600;margin-top:1.5em;margin-bottom:.5em;line-height:1.5}.prose figure figcaption{color:#6b7280;font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.prose code{color:#111827;font-weight:600;font-size:.875em}.prose code::before{content:"`"}.prose code::after{content:"`"}.prose a code{color:#111827}.prose pre{color:#e5e7eb;background-color:#1f2937;overflow-x:auto;font-size:.875em;line-height:1.7142857;margin-top:1.7142857em;margin-bottom:1.7142857em;border-radius:.375rem;padding-top:.8571429em;padding-right:1.1428571em;padding-bottom:.8571429em;padding-left:1.1428571em}.prose pre code{background-color:transparent;border-width:0;border-radius:0;padding:0;font-weight:400;color:inherit;font-size:inherit;font-family:inherit;line-height:inherit}.prose pre code::before{content:none}.prose pre code::after{content:none}.prose table{width:100%;table-layout:auto;text-align:left;margin-top:2em;margin-bottom:2em;font-size:.875em;line-height:1.7142857}.prose thead{color:#111827;font-weight:600;border-bottom-width:1px;border-bottom-color:#d1d5db}.prose thead th{vertical-align:bottom;padding-right:.5714286em;padding-bottom:.5714286em;padding-left:.5714286em}.prose tbody tr{border-bottom-width:1px;border-bottom-color:#e5e7eb}.prose tbody tr:last-child{border-bottom-width:0}.prose tbody td{vertical-align:top;padding-top:.5714286em;padding-right:.5714286em;padding-bottom:.5714286em;padding-left:.5714286em}.prose{font-size:1rem;line-height:1.75}.prose p{margin-top:1.25em;margin-bottom:1.25em}.prose img{margin-top:2em;margin-bottom:2em}.prose video{margin-top:2em;margin-bottom:2em}.prose figure{margin-top:2em;margin-bottom:2em}.prose figure>*{margin-top:0;margin-bottom:0}.prose h2 code{font-size:.875em}.prose h3 code{font-size:.9em}.prose ol{margin-top:1.25em;margin-bottom:1.25em}.prose ul{margin-top:1.25em;margin-bottom:1.25em}.prose li{margin-top:.5em;margin-bottom:.5em}.prose>ul>li p{margin-top:.75em;margin-bottom:.75em}.prose>ul>li>:first-child{margin-top:1.25em}.prose>ul>li>:last-child{margin-bottom:1.25em}.prose>ol>li>:first-child{margin-top:1.25em}.prose>ol>li>:last-child{margin-bottom:1.25em}.prose ol ol,.prose ol ul,.prose ul ol,.prose ul ul{margin-top:.75em;margin-bottom:.75em}.prose hr+*{margin-top:0}.prose h2+*{margin-top:0}.prose h3+*{margin-top:0}.prose h4+*{margin-top:0}.prose thead th:first-child{padding-left:0}.prose thead th:last-child{padding-right:0}.prose tbody td:first-child{padding-left:0}.prose tbody td:last-child{padding-right:0}.prose>:first-child{margin-top:0}.prose>:last-child{margin-bottom:0}.static{position:static}.mx-2{margin-left:.5rem;margin-right:.5rem}.mx-auto{margin-left:auto;margin-right:auto}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.flex{display:flex}.table{display:table}.h-8{height:2rem}.min-h-screen{min-height:100vh}.w-8{width:2rem}.w-9\/12{width:75%}@-webkit-keyframes spin{to{transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}@-webkit-keyframes ping{100%,75%{transform:scale(2);opacity:0}}@keyframes ping{100%,75%{transform:scale(2);opacity:0}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,100%{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes bounce{0%,100%{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.justify-center{justify-content:center}.whitespace-nowrap{white-space:nowrap}.border-t-2{border-top-width:2px}.bg-gray-100{--tw-bg-opacity:1;background-color:rgba(243,244,246,var(--tw-bg-opacity))}.p-4{padding:1rem}.py-4{padding-top:1rem;padding-bottom:1rem}.text-right{text-align:right}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.text-gray-600{--tw-text-opacity:1;color:rgba(75,85,99,var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity:1;color:rgba(55,65,81,var(--tw-text-opacity))}.text-blue-500{--tw-text-opacity:1;color:rgba(59,130,246,var(--tw-text-opacity))}.hover\:text-gray-800:hover{--tw-text-opacity:1;color:rgba(31,41,55,var(--tw-text-opacity))}.underline{text-decoration:underline}*,::after,::before{--tw-shadow:0 0 #0000}*,::after,::before{--tw-ring-inset:var(--tw-empty, );/*!*//*!*/--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59, 130, 246, 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000}@media (min-width:640px){.sm\:items-center{align-items:center}.sm\:pt-0{padding-top:0}}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}</style><link rel="preload" href="/_nuxt/static/1633986775/blog/items/development-of-minir/state.js" as="script"><link rel="preload" href="/_nuxt/static/1633986775/blog/items/development-of-minir/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1633986775/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div data-fetch-key="0" class="items-top min-h-screen bg-gray-100 sm:items-center sm:pt-0"><div class="flex justify-center text-xl py-4"><a href="/" class="underline">GAFTALK</a></div> <div class="container mx-auto"><div><article class="border-t-2 p-4"><a href="/blog/items/development-of-minir" aria-current="page" class="nuxt-link-exact-active nuxt-link-active" style="display:none"></a> <time class="text-right text-sm text-gray-700">2018-06-16🕥</time> <h2 class="text-xl font-bold">MinIRはどのように作られたか</h2> <div class="prose nuxt-content"><h2 id="はじめに"><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>はじめに</h2>
<p>beatorajaの認知度が高まっていくに連れて、<strong>IRがない</strong> という声を多く目にするようになりました。<br>
正確に言えばIRがないというのは誤りで、<code>Chroma IR</code>が存在していましたが、広く公開されているIRではありませんでした。</p>
<p>というわけで、「ないなら作ればいい」のノリで作成したのが現在稼働中の<code>MinIR</code>です。<br>
本記事では、このMinIRがどのようにして作られたかを解説します。</p>
<hr>
<h2 id="やることはそんなに多くない"><a href="#%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8%E3%81%AF%E3%81%9D%E3%82%93%E3%81%AA%E3%81%AB%E5%A4%9A%E3%81%8F%E3%81%AA%E3%81%84" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>やることはそんなに多くない</h2>
<p>さて、そもそもIRはどのような仕組みなのでしょうか。</p>
<p>やることは「データを送り、保存する」「データを取得し、表示する」の2つです。<br>
<img alt="" src="/blog/img/server1.png"></p>
<p>必要なのは</p>
<ul>
<li>IRのデータの受け口</li>
<li>IRのデータを保存するための場所</li>
<li>IRデータの送信機構</li>
<li>IRデータの表示機構</li>
</ul>
<p>の4つです。<br>
そんなに多くありません。</p>
<hr>
<h2 id="必要なものを具体的に"><a href="#%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE%E3%82%92%E5%85%B7%E4%BD%93%E7%9A%84%E3%81%AB" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>必要なものを具体的に</h2>
<p>必要な「機能」を抽出したところで、具体的に何が必要かを考えていきます。</p>
<h3 id="irのデータの受け口"><a href="#ir%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%97%E3%81%91%E5%8F%A3" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>IRのデータの受け口</h3>
<p>データを受け取る「サーバー」が必要です。</p>
<h3 id="irのデータを保存するための場所"><a href="#ir%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E5%A0%B4%E6%89%80" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>IRのデータを保存するための場所</h3>
<p>保存箇所である「データベース」が必要です。</p>
<h3 id="irデータの送信機構"><a href="#ir%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%80%81%E4%BF%A1%E6%A9%9F%E6%A7%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>IRデータの送信機構</h3>
<p>同じく、データ取得命令を処理する「サーバー」が必要です。</p>
<h3 id="irデータの表示機構"><a href="#ir%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%A1%A8%E7%A4%BA%E6%A9%9F%E6%A7%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>IRデータの表示機構</h3>
<p>表示用に「Webページ」が必要です。</p>
<p>こうしてみると、レンタルサーバを借りて、内部にデータベースとWebページ機構を組み込めば良さそうですが…</p>
<hr>
<h2 id="サーバーレスという選択---amazon-web-service"><a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%83%AC%E3%82%B9%E3%81%A8%E3%81%84%E3%81%86%E9%81%B8%E6%8A%9E---amazon-web-service" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>サーバーレスという選択 - Amazon Web Service</h2>
<p>レンタルサーバを借りてどうこうするのは、意外と管理・維持が面倒です。<br>
死活監視やリソース監視、パッチの適用など、サーバーを正常に動作させ続けるためにさまざまな作業が必要です。</p>
<p>そのため、MinIRでは、「サーバーレスアーキテクチャ」を採用しています。</p>
<h3 id="サーバーレスアーキテクチャ"><a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%83%AC%E3%82%B9%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>サーバーレスアーキテクチャ</h3>
<p><strong>サーバを自前で用意せず</strong>、サーバーを持つ事業者が提供するサービスを活用してシステムを構築します。</p>
<p>MinIRでは「サーバーを持つ事業者」は<code>Amazon</code>、「サーバーを持つ事業者が提供するサービス」は<a href="https://aws.amazon.com/jp/" rel="nofollow noopener noreferrer" target="_blank">Amazon Web Service</a>です。</p>
<h3 id="amazon-web-service-aws"><a href="#amazon-web-service-aws" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Amazon Web Service (AWS)</h3>
<p><img alt="" src="/blog/img/aws.png"></p>
<blockquote>
<p>アマゾン ウェブ サービスでは、コンピューティング、ストレージ、データベース、分析、ネットワーキング、モバイル、開発者用ツール、管理ツール、IoT、セキュリティ、エンタープライズアプリケーションなど、グローバルなクラウドベース製品を幅広く利用できます。これらのサービスを使用すると、企業や組織はより迅速かつ低い IT コストでスケールすることができます。AWS は最大規模の企業と注目を集めている新興企業から信頼されており、ウェブアプリケーション、モバイルアプリケーション、ゲーム開発、データ処理、データウェアハウス、ストレージ、アーカイブなど多様なワークロードを支援しています。</p>
<p>製品ページより引用 <a href="https://aws.amazon.com/jp/products/" rel="nofollow noopener noreferrer" target="_blank">(https://aws.amazon.com/jp/products/)</a></p>
</blockquote>
<p>簡単言えば <strong>いろんなサービスがあるから、それらをうまく組み合わせて活用してね！</strong> でしょうか。<br>
実際、その通りなので、MinIRで利用しているサービスを解説します。</p>
<hr>
<h2 id="minirで利用するawsサービス"><a href="#minir%E3%81%A7%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8Baws%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>MinIRで利用するAWSサービス</h2>
<p>MinIRで利用するサービスは主に下記の3つです。</p>
<ul>
<li>AWS Lambda (lambda)</li>
<li>Amazon DynamoDB (DynamoDB)</li>
<li>Amazon Cognito (Cognito)</li>
</ul>
<h3 id="aws-lambda"><a href="#aws-lambda" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>AWS Lambda</h3>
<p><img alt="" src="/blog/img/lambda.png"></p>
<p>(「ラムダ」って読みます)<br>
イベントに対してコードを実行するサービスです。<br>
「データを受け取る」「データ要求に対して送信する」の2つの役割に対してこのサービスを使います。</p>
<p>具体的には</p>
<ul>
<li>データを受け取る
<ul>
<li>受け取ったスコア・譜面データを<code>DynamoDB</code>に保存する</li>
</ul>
</li>
<li>データ要求に対して送信する
<ul>
<li>要求に沿う形でスコア・譜面データを<code>DynamoDB</code>から取得し、返却する</li>
</ul>
</li>
</ul>
<p>を行います。</p>
<p>コードは<code>Node.js</code>、<code>Java</code>、<code>C#</code>、<code>Go</code>、<code>Python</code>が選択できますが、MinIRでは<code>Node.js</code>を採用しています。
（<code>Node.js</code>の説明は<a href="https://eng-entrance.com/what-is-nodejs" rel="nofollow noopener noreferrer" target="_blank">この辺</a>とかかな？）</p>
<p>ひと月あたり</p>
<ul>
<li>1,000,000回（100万回）の呼び出し</li>
<li>メモリを400,000GB（40万GB）秒利用する
<ul>
<li>例1：256MBの処理を4秒で1GB秒</li>
<li>例2：1GBの処理を0.5秒で0.5GB秒</li>
</ul>
</li>
</ul>
<p>を満たすまでは<strong>無料</strong>です。</p>
<p>(<a href="https://aws.amazon.com/jp/lambda/pricing/" rel="nofollow noopener noreferrer" target="_blank">AWS Lambda 料金</a>)</p>
<h3 id="amazon-dynamodb"><a href="#amazon-dynamodb" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Amazon DynamoDB</h3>
<p><img alt="" src="/blog/img/dynamodb.png"></p>
<p>(「ダイナモDB」って読みます)<br>
データベースサービスですが、一般的な<a href="https://aws.amazon.com/jp/relational-database/" rel="nofollow noopener noreferrer" target="_blank">リレーショナルデータベース (RDB)</a>ではありません。<br>
<a href="https://aws.amazon.com/jp/nosql/" rel="nofollow noopener noreferrer" target="_blank">NoSQL データベース (NoSQL)</a>と呼ばれる非リレーショナルデータベースです。</p>
<p>NoSQL データベースとは<strong>一意キー</strong>と<strong>値</strong>の単純な組み合わせを格納したデータベースです。<br>
以下は簡単な例です。</p>





















<table><thead><tr><th>一意キー</th><th>値</th></tr></thead><tbody><tr><td>ユーザーID + 譜面ID</td><td>スコア、記録日時 …</td></tr><tr><td>譜面ID</td><td>タイトル、BPM、総ノーツ数 …</td></tr><tr><td>ユーザーID</td><td>bio、ライバル情報 …</td></tr></tbody></table>
<p>※MinIRが上記の例の通りに作られているわけではありません</p>
<p>キーと値のペアのため、RDBとは違ったメリット、デメリットが存在します。</p>

























<table><thead><tr><th></th><th>RDB</th><th>NoSQL</th></tr></thead><tbody><tr><td>データ参照</td><td>複数の表と関係性を持ち、SQLを用いて、高度な条件でのデータを取得できる</td><td>他のデータとの関係性がないため、複雑な参照には不向き</td></tr><tr><td>トランザクション</td><td>データの不整合は起こらない</td><td>結果整合性を持つ（即座にデータの変更が反映されるとは限らない）</td></tr><tr><td>処理速度</td><td>強固なトランザクション処理を行うため、それほど速くはない</td><td>大量のデータを扱うサービスで参照や追加処理が主な処理である場合、高速</td></tr></tbody></table>
<p>上記だけ見ると、IRのようなデータ保存・更新サービスではNoSQLは不向きなのでは？と思われると思います。<br>
<strong>その通りです。</strong><br>
ユーザー・スコア・譜面 など、リレーショナルなデータ参照があるのでRDBのほうが向いているのですが…。</p>
<p><strong>残念ながら、RDBは無料で運用できません。</strong></p>
<p>AWSにも<code>Amazon Relational Database Service (RDS)</code>というサービスがありますが、無料で利用することはできません。<br>
Amazon以外のサービスも同様です。</p>
<p><code>DynamoDB</code>は料金体系が複雑ですが、IRのような単純なWebサービス構築ならば無料で運用できるはずです。</p>
<ul>
<li>25 GB の保管は無料</li>
<li>読み込み/書き込み容量が少なければ無料</li>
</ul>
<p>(<a href="https://aws.amazon.com/jp/dynamodb/pricing/" rel="nofollow noopener noreferrer" target="_blank">Amazon DynamoDB 料金</a>)</p>
<p>MinIRでは前述した<code>lambda</code>と連携して、データの書き込み、読み込みを行います。</p>
<h3 id="amazon-cognito"><a href="#amazon-cognito" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Amazon Cognito</h3>
<p><img alt="" src="/blog/img/cognito.png"></p>
<p>(「コグニト」って読みます)<br>
ユーザー認証や情報を取り扱うサービスです。</p>
<ul>
<li>パスワードや個人情報の管理</li>
<li>(自前でやろうとすると大変な)2段階認証</li>
<li>自前の認証サービス</li>
</ul>
<p>と、ユーザー管理・運用に最低限必要なのが揃ってます。<strong>めっちゃ楽です。</strong><br>
（やろうと思えばtwitterでのログインも実装できますが、MinIRでは採用してません。）</p>
<p>同じく、<code>lambda</code>と連携して、ログイン処理、ユーザーデータの追加・取得を行います。</p>
<p>ひと月あたり5万ユーザーまでは<strong>無料</strong>です。<br>
(<a href="https://aws.amazon.com/jp/cognito/pricing/" rel="nofollow noopener noreferrer" target="_blank">AWS Cognito 料金</a>)</p>
<hr>
<h2 id="サービスを組み合わせる"><a href="#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92%E7%B5%84%E3%81%BF%E5%90%88%E3%82%8F%E3%81%9B%E3%82%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>サービスを組み合わせる</h2>
<p>上記で紹介したAWSサービスを組み合わせるとこんな感じになります</p>
<ul>
<li>ログイン処理
<ol>
<li>lambdaにログイン情報送信</li>
<li>lambdaからCognitoに情報問い合せ</li>
<li>Cognitoからlambdaに結果返却</li>
<li>lambdaから結果返却</li>
</ol>
</li>
<li>スコア送信処理
<ol>
<li>lambdaにスコア情報送信</li>
<li>lambdaからDynamoDBに書き込み</li>
<li>（必要なら）lambdaから処理結果を返却</li>
</ol>
</li>
</ul>
<p>なんとかうまくいきそうです。<br>
残りは保存されたスコアを表示するIRページの作成です。</p>
<hr>
<h2 id="webページも無料で作る--github-pages-"><a href="#web%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%82%E7%84%A1%E6%96%99%E3%81%A7%E4%BD%9C%E3%82%8B--github-pages-" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Webページも無料で作る -Github Pages-</h2>
<p><a href="https://pages.github.com/" rel="nofollow noopener noreferrer" target="_blank">GitHub Pages</a> とは、<a href="https://github.com/" rel="nofollow noopener noreferrer" target="_blank">GitHub</a>による、静的サイトのホスティングサービスです。<br>
<code>GitHub</code>のアカウントがあればすぐに公開できるので、非常に手軽です。</p>
<ul>
<li>静的サイト (HTML や CSS, 画像など) を公開できます</li>
<li>JavaScriptが動作します</li>
<li>独自ドメインOK</li>
<li><strong>無料</strong></li>
</ul>
<p>htmlをうまーく配置すれば、それだけでサイトが公開できます。<br>
データの取得（lambdaの呼び出し）には<code>javascript</code>を用います。</p>
<p>サイトのソースコードは<a href="https://github.com/SackMagiclight/minir" rel="nofollow noopener noreferrer" target="_blank">こちら</a>です。<br>
静的サイトなので、基本全公開です。</p>
<p>MinIRのデザインには<a href="https://getmdl.io/" rel="nofollow noopener noreferrer" target="_blank">Material Design Lite</a>、テンプレートエンジンには<a href="https://reactjs.org/" rel="nofollow noopener noreferrer" target="_blank">React</a>を利用しています。<br>
（詳細情報は各公式ページへ。）</p>
<p>というわけで、スコアビューワーもできました。
<img alt="" src="/blog/img/minir_score.png"></p>
<hr>
<h2 id="まとめシステム全体像"><a href="#%E3%81%BE%E3%81%A8%E3%82%81%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E5%85%A8%E4%BD%93%E5%83%8F" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>まとめ（システム全体像）</h2>
<p><img alt="" src="/blog/img/minir_system.png"></p>
<p>こんな感じになりました。<br>
基本的にはlambdaを経由して、データの流れを作ります。</p>
<hr>
<h2 id="おわりに"><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>おわりに</h2>
<p>というわけで、このような流れがあってMinIRは作られました。<br>
無料でクラウドサービスを利用でき、サービス開発ができるなんていい時代だぁ…<br>
AWS便利だからみんな使おうね！<br>
IRを新しく作るのもいいぞ。</p></div> <div class="mt-4"><div class="w-8 h-8"><a href="https://twitter.com/intent/tweet?url=https://www.gaftalk.com/blog/items/development-of-minir/&text=MinIRはどのように作られたか" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="32" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" class="w-8 h-8 text-gray-600 hover:text-gray-800"><path d="M22.46 6c-.77.35-1.6.58-2.46.69c.88-.53 1.56-1.37 1.88-2.38c-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29c0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15c0 1.49.75 2.81 1.91 3.56c-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07a4.28 4.28 0 0 0 4 2.98a8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21C16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56c.84-.6 1.56-1.36 2.14-2.23z" fill="currentColor"></path></svg></a></div></div></article></div> <a href="/2018/06/16/development-of-minir/"></a></div> <div class="container w-9/12 mx-auto py-4"><div class="flex flex-col"><h2>記事</h2> <div class="flex text-sm mx-2"><div class="flex flex-wrap"><div><a href="/blog/ym/2021-10/" class="mx-2 text-blue-500 whitespace-nowrap">2021-10</a></div><div><a href="/blog/ym/2019-07/" class="mx-2 text-blue-500 whitespace-nowrap">2019-07</a></div><div><a href="/blog/ym/2019-06/" class="mx-2 text-blue-500 whitespace-nowrap">2019-06</a></div><div><a href="/blog/ym/2019-05/" class="mx-2 text-blue-500 whitespace-nowrap">2019-05</a></div><div><a href="/blog/ym/2019-03/" class="mx-2 text-blue-500 whitespace-nowrap">2019-03</a></div><div><a href="/blog/ym/2019-02/" class="mx-2 text-blue-500 whitespace-nowrap">2019-02</a></div><div><a href="/blog/ym/2019-01/" class="mx-2 text-blue-500 whitespace-nowrap">2019-01</a></div><div><a href="/blog/ym/2018-12/" class="mx-2 text-blue-500 whitespace-nowrap">2018-12</a></div><div><a href="/blog/ym/2018-10/" class="mx-2 text-blue-500 whitespace-nowrap">2018-10</a></div><div><a href="/blog/ym/2018-08/" class="mx-2 text-blue-500 whitespace-nowrap">2018-08</a></div><div><a href="/blog/ym/2018-06/" class="mx-2 text-blue-500 whitespace-nowrap">2018-06</a></div><div><a href="/blog/ym/2018-04/" class="mx-2 text-blue-500 whitespace-nowrap">2018-04</a></div><div><a href="/blog/ym/2018-01/" class="mx-2 text-blue-500 whitespace-nowrap">2018-01</a></div><div><a href="/blog/ym/2017-12/" class="mx-2 text-blue-500 whitespace-nowrap">2017-12</a></div><div><a href="/blog/ym/2017-11/" class="mx-2 text-blue-500 whitespace-nowrap">2017-11</a></div><div><a href="/blog/ym/2017-10/" class="mx-2 text-blue-500 whitespace-nowrap">2017-10</a></div></div></div></div> <div class="flex flex-col mt-2"><h2>BMS</h2> <div class="flex text-sm mx-2"><div class="flex flex-wrap"><div><a href="https://www.gaftalk.com/1to24_2nd/" class="underline mx-2">1to24 2nd</a></div></div></div></div> <div class="flex flex-col mt-2"><h2>その他</h2> <div class="flex text-sm mx-2"><div class="flex flex-wrap"><div><a href="https://twitter.com/sack_magiclight" class="underline mx-2">twitter</a></div> <div><a href="https://github.com/SackMagiclight" class="underline mx-2">github</a></div></div></div></div></div></div></div></div><script defer src="/_nuxt/static/1633986775/blog/items/development-of-minir/state.js"></script><script src="/_nuxt/9a8cbb4.js" defer></script><script src="/_nuxt/0b107f7.js" defer></script><script src="/_nuxt/d600e52.js" defer></script><script src="/_nuxt/a5b918d.js" defer></script><script src="/_nuxt/eef1235.js" defer></script>
  </body>
</html>
